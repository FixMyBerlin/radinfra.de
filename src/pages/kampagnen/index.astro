---
import CampaignCards from '@components/page_kampagne/CampaignCards.astro'
import { CampaignLeaderboard } from '@components/page_kampagne/CampaignLeaderboard'
import PageHeadline from '@components/text/PageHeadline.astro'
import ProseSection from '@components/text/ProseSection.astro'
import { EyeIcon } from '@heroicons/react/24/solid'
import LayoutArticlePageAstro from '@layouts/LayoutArticlePageAstro.astro'
import { getCollection } from 'astro:content'

const allCampaigns = await getCollection('campaigns')
const sortedCampaigns = allCampaigns
  .filter((c) => {
    if (c.data.visibility === 'hidden') return false
    if (c.data.maprouletteChallenge.discriminant === false) return true
    return (
      c.data.maprouletteChallenge.discriminant === true &&
      c.data.maprouletteChallenge.value.id &&
      c.data.maprouletteChallenge.value.enabled === true
    )
  })
  .sort((postA, postB) => {
    return new Date(postB.data.pubDate).valueOf() - new Date(postA.data.pubDate).valueOf()
  })
---

<LayoutArticlePageAstro title="Kampagnen zur Verbesserung der Radinfrastrukturdaten">
  <PageHeadline
    category={undefined}
    headline="Kampagnen"
    intro="Überall in Deutschland können wir die Daten noch besser machen. Diese Kampagnen helfen euch Verbesserungspotential zu finden."
  />

  <ProseSection classes="mb-12">
    <p>
      Diese Daten stammen aus dem <a href="https://radverkehrsatlas.de/" target="_blank">
        Projekt Radverkehrsatlas
      </a> von FixMyCity.
    </p>
  </ProseSection>

  <ProseSection highlight classes="prose-green my-12 flex gap-3">
    <EyeIcon className="prose-green size-8 text-green-800" />
    <div>
      <p>Alle Kampagnen setzen voraus, dass du dich mit OpenStreetMap auskennst.</p>
      <p><a href="/mitmachen">Es gibt viele Wege, mitzuhelfen…</a></p>
    </div>
  </ProseSection>

  <CampaignCards
    headlineTemplate="Kampagnen zu »CATEGORY«"
    campaigns={sortedCampaigns}
    showEmptyCategories={true}
  />

  <ProseSection classes="mt-18">
    <hr />
    <CampaignLeaderboard client:only="react" />
  </ProseSection>
</LayoutArticlePageAstro>
